// Generated by CoffeeScript 1.5.0
(function() {
  var PayPeriod, moment,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  moment = typeof require !== "undefined" && require !== null ? require("moment") : this.moment;

  PayPeriod = (function() {

    function PayPeriod(yearStart, type, format) {
      this._biweekly = __bind(this._biweekly, this);      this.format = format || 'YYYY-MM-DD';
      this.yearStart = this._initDate(yearStart);
      this.type = type || 'weekly';
    }

    PayPeriod.prototype["for"] = function(d) {
      var date;
      date = this._initDate(d);
      switch (this.type) {
        case 'weekly':
          return this._weekly(date);
        case 'biweekly':
          return this._biweekly(date);
        case 'semimonthly':
          return this._semimonthly(date);
        case 'monthly':
          return this._monthly(date);
      }
    };

    PayPeriod.prototype._weekly = function(date) {
      var s, start, stop;
      s = this.yearStart.clone();
      while (this._lte(s, date)) {
        s.add('w', 1);
      }
      start = s.clone().subtract('w', 1);
      stop = start.clone().add('d', 6);
      return this._formatResult(start, stop);
    };

    PayPeriod.prototype._biweekly = function(date) {
      var s, start, stop;
      s = this.yearStart.clone();
      while (this._lte(s, date)) {
        s.add('w', 2);
      }
      start = s.clone().subtract('w', 2);
      stop = start.clone().add('d', 13);
      return this._formatResult(start, stop);
    };

    PayPeriod.prototype._semimonthly = function(date) {
      var e, s;
      if (date.date() < 16) {
        s = moment([date.year(), date.month()]);
        e = moment([date.year(), date.month(), 15]);
      } else {
        s = moment([date.year(), date.month(), 16]);
        e = moment([date.year(), date.month()]).add('M', 1).subtract('d', 1);
      }
      return this._formatResult(s, e);
    };

    PayPeriod.prototype._monthly = function(date) {
      var e, s;
      s = moment([date.year(), date.month()]);
      e = s.clone().add('M', 1).subtract('d', 1);
      return this._formatResult(s, e);
    };

    PayPeriod.prototype._lte = function(d1, d2) {
      return d1.unix() <= d2.unix();
    };

    PayPeriod.prototype._formatResult = function(start, stop) {
      return {
        start: start.format(this.format),
        stop: stop.format(this.format),
        days: this._days(start, stop)
      };
    };

    PayPeriod.prototype._days = function(start, stop) {
      var a, s;
      s = start.clone();
      a = [];
      while (this._lte(s, stop)) {
        a.push(s.format(this.format));
        s.add('d', 1);
      }
      return a;
    };

    PayPeriod.prototype._initDate = function(date) {
      if (moment.isMoment(date)) {
        return date;
      } else {
        return moment(date, this.format);
      }
    };

    return PayPeriod;

  })();

  moment.fn.payperiod = function(yearStart, type) {
    return new PayPeriod(yearStart, type);
  };

}).call(this);
